/*
	jQuery plugin for custom ui dialog.
	Requires 
		-> debug.iframe.min.css
		-> jquery-ui.min.css
		-> jquery-ui.min.js 
	to be included in your page.And jQuery, obviously.

	Authod: Md.Shiaikot Ikbal Hridoy
	Designation: Senior Software Enginner 
	Email: ikbal15.1320.japan@gmail.com
*/

/* ---------------------------------------------------- */

/*
Usage:

$('#debugDialog').debugDialog({
	icon: '<?php echo base_url('assets/modal/delete_success.png')?>',
	title: 'confirmation message 2021',
	width: 650,
	height: 300,
	body: {
		textalign : 'center',
		padding : '15px 15px 30px 15px'
	},
	type: {
		name : 'information',
		message : 'successfully! save your information'
	},
	type: {
		name : 'delete',
		message : 'are you sure to delete this information ? ',
		ajax: {
			url: 'product/view',
			mrthod: 'POST',
			params: new URLSearchParams({
				title : 'hello', 
				msg : 'world', 
			}).toString(),
			icon: '',
			module: ''
		}
	},
	type: {
		name : 'ajax',
		ajax: {
			url: 'product/view',
			params: new URLSearchParams({
				title : 'hello', 
				msg : 'world', 
			}).toString()
		}
	}
});
*/

// add modal frame into project body
$('body').find('#debugDialog').remove();

var modal = 
`
	<div id="debugDialog" class="modal" role="dialog">
	  <div class="modal-dialog">
	    <div class="modal-content">
	      <div class="modal-header">
	        <div>
	          <img src="">
	          <h4 class="modal-title"></h4>
	        </div>
	        <button class="closeBtn">ðŸ—™ï¸Ž</button>
	      </div>
	      <div class="modal-body"></div>
	      <div class="footer"></div>
	    </div>
	  </div>
	</div>
`;

$('body').append(modal);

// project dialog frame script
jQuery.fn.debugDialog = function(option) {
	var _obj = this;

	if(option == 'close'){
		_obj.css('display','none');
	}

	$('.modal-dialog').draggable({
	      "handle":".modal-header"
	});

	_obj.find('.closeBtn').click(function(){
		_obj.css('display','none');
	});

	if(option.icon != ''){
		_obj.find('.modal-header div img').attr('src',option.icon);
	}
	else{
		_obj.find('.modal-header div img').remove();
	}

	if(option.title){
		_obj.find('.modal-header .modal-title').html(option.title);
	}

	if(option.width){
		_obj.find('.modal-content').width(option.width);
	}

	if(option.height){
		if(option.height == 'auto'){
			_obj.find('.modal-content').height('auto');
		}
		_obj.find('.modal-content').height(option.height);
	}

	if(option.body){
		if(option.body.textalign){
			_obj.find('.modal-body').css('text-align',option.body.textalign);
		}

		if(option.body.padding){
			_obj.find('.modal-body').css('padding',option.body.padding);
		}
	}

	if(option.type.name == 'information'){
		let dialogMsg = 
		`
			<p>`+option.type.message+`</p>
			<div class="btnGroup">
			  	<button type="button" class="cancel closeBtn">
			    	<img src="`+option.type.no_btn+`">
			    	<span>Close</span>
			  	</button>
			</div> 
		`;
		_obj.find('.modal-body').html(dialogMsg);
		_obj.find('.closeBtn').click(function(){
			_obj.css('display','none');
		});
	}

	if(option.type.name == 'database'){
		let dialogMsg = 
		`
			<div style='display:flex;flex-direction:row;justify-content: center;align-items: center;'>
				<img src="`+option.type.loading+`" style="width: 24px;height: 24px;"> 
				<p style=
				"
					margin: 0px;
					font-size: 12px;
					font-weight: bold;
					text-transform: capitalize;
					margin-left: 5px;
				">`+option.type.message+`</p>
			</div>
		`;
		_obj.find('.modal-body').html(dialogMsg);

		// ajax
		if(option.type.ajax){
			$.ajax({
				url: option.type.ajax.url,
				nethod: 'POST',
				data:{},
				success: function(res){
					_obj.css('display','none');

					$('#debugDialog').debugDialog({
						icon: option.type.ajax.icon,
						title: 'confirmation message',
						width: 650,
						height: 150,
						body: {
							textalign : 'center',
							padding : '15px 15px 30px 15px'
						},
						type: {
							name : 'information',
							message : 'database upload has been successfully',
							no_btn: option.type.ajax.close
						}
					});
				},
				error: function(err){
					console.log(err);
				}
			});
		}
	}

	if(option.type.name == 'delete'){
		let dialogMsg = 
		`
			<p>`+option.type.message+`</p>
			<div class="btnGroup">
			  	<button type="button" class="cancel closeBtn">
			    	<img src="`+option.type.ajax.no_btn+`">
			    	<span>Close</span>
			  	</button>
			  	<button type="button" class="ok" onclick=
			  	"
			  		deleteInformation(this);
			  		function deleteInformation(obj){
			  			$.ajax({
			  				url: '`+option.type.ajax.url+`',
			  				method: '`+option.type.ajax.method+`',
			  				data: '`+option.type.ajax.params+`',
			  				success: function(res){
			  					$('#debugDialog').debugDialog({
			  						icon: '`+option.type.ajax.icon+`',
			  						title: 'success message',
			  						width: 450,
			  						height: 165,
			  						body: {
			  							textalign : 'center',
			  							padding : '30px 0px'
			  						},
			  						type: {
			  							name : 'information',
			  							message : 'Data has been delete successfully',
			  							no_btn: '`+option.type.ajax.no_btn+`'
			  						}
			  					});

			  					`+option.type.ajax.module+`.currentpage = 1;
			  					`+option.type.ajax.module+`.start = 0;
			  					`+option.type.ajax.module+`.isJson = 1;
			  					`+option.type.ajax.module+`.populateDataTable();
			  				},
			  				error: function(err){
			  					console.log(err);
			  				}
			  			});
			  		}
			  	">
			  	  <img src="`+option.type.ajax.yes_btn+`">
			  	  <span>yes</span>
			  	</button>
			</div> 
		`;
		_obj.find('.modal-body').html(dialogMsg);
		_obj.find('.closeBtn').click(function(){
			_obj.css('display','none');
		});
	}

	if(option.type.name == 'ajax'){
		if(option.type.ajax){
			_obj.find('.modal-body').html('');
			_obj.find('.modal-body').load(option.type.ajax.url,option.type.ajax.params,function(responseTxt, statusTxt, xhr)
			{
				if(statusTxt == "success"){

		      		let modalWidth = _obj.find('.modal-content').outerWidth(true);
		      		let modalHeight = _obj.find('.modal-content').outerHeight(true);

		      		let windowWidth = $(window).innerWidth();
		      		let windowHeight = $(window).innerHeight();

		      		let dialogLeft = ((windowWidth - modalWidth) / 2);
		      		let dialogTop = ((windowHeight - modalHeight) / 2);

		      		_obj.find('.modal-dialog').css('position','absolute');
		      		_obj.find('.modal-dialog').css('left',dialogLeft+'px');
		      		_obj.find('.modal-dialog').css('top',(dialogTop - 35) +'px');

		      		_obj.css('display','block');
				}

		    	if(statusTxt == "error"){
		      		console.log("Error: " + xhr.status + ": " + xhr.statusText);
		      	}
			})
		}
	}

	let modalWidth = _obj.find('.modal-content').outerWidth(true);
	let modalHeight = _obj.find('.modal-content').outerHeight(true);

	let windowWidth = $(window).innerWidth();
	let windowHeight = $(window).innerHeight();

	let dialogWidth = ((windowWidth - modalWidth) / 2);
	let dialogHeight = ((windowHeight - modalHeight) / 2);

	_obj.find('.modal-dialog').css('position','absolute');
	_obj.find('.modal-dialog').css('left',dialogWidth+'px');
	_obj.find('.modal-dialog').css('top',(dialogHeight - 35) +'px');

	_obj.css('display','block');
};